<link rel="stylesheet" href="css/service-tracking.css">

<div class="service-tracking-container">

    <div class="service-tracking-header">
        <h2><i class='bx bxs-compass'></i> Service Tracking</h2>
    </div>

    <div class="st-dashboard-summary">
        <div class="st-dashboard-scorecards">
            <div class="st-scorecard">
                <div class="st-scorecard-icon">
                    <i class='bx bx-data'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Total Services</h4>
                    <p id="db-total-services">0</p>
                </div>
            </div>
            <div class="st-scorecard">
                <div class="st-scorecard-icon ocean">
                    <i class='bx bxs-ship'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Ocean Services</h4>
                    <p id="db-ocean-services">0</p>
                </div>
            </div>
            <div class="st-scorecard">
                <div class="st-scorecard-icon air">
                    <i class='bx bxs-plane-alt'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Air Services</h4>
                    <p id="db-air-services">0</p>
                </div>
            </div>
            <div class="st-scorecard">
                <div class="st-scorecard-icon truck">
                    <i class='bx bxs-truck'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Truck Services</h4>
                    <p id="db-truck-services">0</p>
                </div>
            </div>
            <div class="st-scorecard">
                <div class="st-scorecard-icon completed">
                    <i class='bx bx-check-circle'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Services Finalized</h4>
                    <p id="db-completed-services">0</p>
                </div>
            </div>
            <div class="st-scorecard">
                <div class="st-scorecard-icon in-progress">
                    <i class='bx bx-loader-circle'></i>
                </div>
                <div class="st-scorecard-info">
                    <h4>Services In Progress</h4>
                    <p id="db-inprogress-services">0</p>
                </div>
            </div>
        </div>
        <div class="st-dashboard-charts">
            <div class="st-chart-container">
                <h4><i class='bx bx-time-five'></i> Upcoming Deadlines (ETA/ETD)</h4>
                <ul id="db-upcoming-list" class="st-upcoming-list-simple">
                    <li class="no-upcoming-data">No upcoming services to display.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="st-controls-bar">
        <div class="st-table-view-selector">
            <label for="tableViewType">Table View (Current Month):</label>
            <select id="tableViewType">
                <option value="all" selected>üö¢‚úàÔ∏èüöö All Services</option>
                <option value="ocean">üåä Ocean</option>
                <option value="air">‚úàÔ∏è Air</option>
                <option value="truck">üöö Domestic / Truck</option>
            </select>
        </div>
        <div class="st-controls-buttons">
            <button id="openProgressNotificationModalBtnManual" class="btn-goldmex-secondary">
                <i class='bx bx-bell'></i> View Progress
            </button>
            <button id="openArchiveModalBtn" class="btn-goldmex-secondary">
                <i class='bx bx-archive'></i> History/Future
            </button>
            <button id="openServiceModalBtn" class="btn-goldmex-primary">
                <i class='bx bx-plus-circle'></i> Open Service
            </button>
        </div>
    </div>

    <div id="serviceModal" class="st-modal">
        <div class="st-modal-content st-modal-content-xlarge"> <div class="st-modal-header">
                <h3><i class='bx bx-slider-alt'></i> Create New Service</h3>
                <button class="st-close-button" id="closeServiceModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <form id="newServiceForm" class="st-modal-body st-modal-body-columns">
                <div class="st-form-main-column">
                    <div class="st-form-column-section">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bx-info-circle'></i> General Information</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="serviceCategoryModal">Service Type: <span class="st-required">*</span></label>
                                    <select id="serviceCategoryModal" name="serviceCategoryModal" required>
                                        <option value="" disabled selected>Select a type...</option>
                                        <option value="ocean">üåä Ocean</option>
                                        <option value="air">‚úàÔ∏è Air</option>
                                        <option value="truck">üöö Domestic / Truck</option>
                                    </select>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="customerModal">Customer: <span class="st-required">*</span></label>
                                    <input type="text" id="customerModal" name="customerModal" placeholder="Customer Name" required>
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="etdModal">ETD: <span class="st-required">*</span></label>
                                    <input type="date" id="etdModal" name="etdModal" required>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="etaModal">ETA: <span class="st-required">*</span></label>
                                    <input type="date" id="etaModal" name="etaModal" required>
                                </div>
                            </div>
                        </div>

                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-user-detail'></i> Parties Involved</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="shipperModal">Shipper: <span class="st-required">*</span></label>
                                    <input type="text" id="shipperModal" name="shipperModal" placeholder="Shipper Name" required>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="consigneeModal">Consignee: <span class="st-required">*</span></label>
                                    <input type="text" id="consigneeModal" name="consigneeModal" placeholder="Consignee Name" required>
                                </div>
                            </div>
                            <div class="st-form-row">
                                 <div class="st-form-group st-form-group-col">
                                    <label for="carrierModal">Carrier: <span class="st-required">*</span></label>
                                    <input type="text" id="carrierModal" name="carrierModal" placeholder="Carrier Name" required>
                                </div>
                                <div class="st-form-group st-form-group-col" id="flightNumberGroupModal" style="display:none;">
                                    <label for="flightNumberModal">Flight Number (Air):</label>
                                    <input type="text" id="flightNumberModal" name="flightNumberModal" placeholder="Flight Number">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="st-form-column-section">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-map-pin'></i> Logistics Details</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="polModal">POL:</label>
                                    <input type="text" id="polModal" name="polModal" placeholder="Port/Point of Loading">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="podModal">POD:</label>
                                    <input type="text" id="podModal" name="podModal" placeholder="Port/Point of Discharge">
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="finalDestinationModal">Final Destination:</label>
                                    <input type="text" id="finalDestinationModal" name="finalDestinationModal" placeholder="Final Destination">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="mblHawbModal">MBL / MAWB / PRO:</label>
                                    <input type="text" id="mblHawbModal" name="mblHawbModal" placeholder="MBL/MAWB/PRO">
                                </div>
                            </div>
                             <div class="st-form-row">
                                <div class="st-form-group st-form-group-col" id="hblHawbGroupModal" style="display:none;">
                                    <label for="hblModal">HBL (Ocean) / HAWB (Air):</label>
                                    <input type="text" id="hblModal" name="hblModal" placeholder="HBL / HAWB">
                                </div>
                                <div class="st-form-group st-form-group-col"></div> </div>
                        </div>

                        <div class="st-form-section">
                             <h4 class="st-form-section-title"><i class='bx bx-cog'></i> Service Specifics</h4>
                            <div id="oceanFieldsModal" class="st-service-type-fields">
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="oceanServiceTypeModal">Ocean Service Type: <span class="st-required">*</span></label>
                                        <select id="oceanServiceTypeModal" name="oceanServiceTypeModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="LCL">LCL</option> <option value="FCL">FCL</option>
                                        </select>
                                    </div>
                                    <div class="st-form-group st-form-group-col">
                                        <label for="oceanServiceModal">Ocean Service: <span class="st-required">*</span></label>
                                        <select id="oceanServiceModal" name="oceanServiceModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="Door to Door">Door to Door</option> <option value="Door to Port">Door to Port</option>
                                            <option value="Port to Door">Port to Door</option> <option value="Port to Port">Port to Port</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="st-form-row" id="containerFieldsModal" style="display:none;">
                                     <div class="st-form-group st-form-group-col">
                                        <label for="containerNumberModal">Container Number:</label>
                                        <input type="text" id="containerNumberModal" name="containerNumberModal">
                                    </div>
                                     <div class="st-form-group st-form-group-col">
                                        <label for="containerTypeModal">Container Type:</label>
                                        <input type="text" id="containerTypeModal" name="containerTypeModal">
                                    </div>
                                </div>
                                <div class="st-form-row">
                                     <div class="st-form-group st-form-group-col">
                                        <label for="sealNumberModal">Seal Number:</label>
                                        <input type="text" id="sealNumberModal" name="sealNumberModal">
                                    </div>
                                    <div class="st-form-group st-form-group-col"></div>
                                </div>
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="isfFileModal">ISF File:</label>
                                        <input type="file" id="isfFileModal" name="isfFileModal" class="st-file-input">
                                    </div>
                                    <div class="st-form-group st-form-group-col st-checkbox-group" style="align-self: flex-end; padding-bottom: 0.7rem;">
                                        <input type="checkbox" id="addIsfLaterModal" name="addIsfLaterModal">
                                        <label for="addIsfLaterModal">Add ISF Later <span class="st-required" id="isfRequiredIndicatorModal">*</span></label>
                                    </div>
                                </div>
                                <p class="st-validation-error" id="isfErrorModal" style="display:none;"></p>
                            </div>
                            <div id="truckFieldsModal" class="st-service-type-fields">
                                 <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="truckServiceTypeModal">Truck Service Type: <span class="st-required">*</span></label>
                                        <select id="truckServiceTypeModal" name="truckServiceTypeModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="FTL">FTL</option> <option value="LTL">LTL</option>
                                        </select>
                                    </div> <div class="st-form-group st-form-group-col"></div>
                                </div>
                            </div>
                            <div id="airFieldsModal" class="st-service-type-fields">
                                <p><em>No additional mandatory fields for Air.</em></p>
                            </div>
                        </div>
                    </div>
                     <div class="st-form-bottom-row">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-package'></i> Cargo Details</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="numPackagesModal"># Packages:</label>
                                    <input type="number" id="numPackagesModal" name="numPackagesModal">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="grossWeightModal">Gross Weight (kg):</label>
                                    <input type="number" step="0.01" id="grossWeightModal" name="grossWeightModal">
                                </div>
                            </div>
                            <div class="st-form-row" id="dimensionsCbmGroupModal" style="display:none;">
                                <div class="st-form-group st-form-group-col">
                                    <label for="dimensionsModal">Dimensions (Air/Truck):</label>
                                    <input type="text" id="dimensionsModal" name="dimensionsModal">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="cbmModal">CBM (Truck):</label>
                                    <input type="number" step="0.001" id="cbmModal" name="cbmModal">
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col-full">
                                    <label for="commodityDescriptionModal">Commodity Description:</label>
                                    <textarea id="commodityDescriptionModal" name="commodityDescriptionModal" rows="2"></textarea>
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="htsCodeModal">HTS Code:</label>
                                    <input type="text" id="htsCodeModal" name="htsCodeModal">
                                </div>
                                <div class="st-form-group st-form-group-col"></div>
                            </div>
                        </div>
                        <div class="st-form-section">
                             <h4 class="st-form-section-title"><i class='bx bx-analyse'></i> Status & Notes</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="serviceStatusModal">Initial Status:</label>
                                    <select id="serviceStatusModal" name="serviceStatusModal">
                                        <option value="Pending" selected>Pending</option> <option value="Booked">Booked</option>
                                        <option value="In Transit">In Transit</option> <option value="At Destination">At Destination</option>
                                        <option value="Delivered">Delivered</option> <option value="On Hold">On Hold</option>
                                        <option value="Cancelled">Cancelled</option> <option value="Completed">Completed</option>
                                    </select>
                                </div>
                                <div class="st-form-group st-form-group-col"></div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col-full">
                                    <label for="serviceNotesModal">Additional Notes:</label>
                                    <textarea id="serviceNotesModal" name="serviceNotesModal" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="st-charges-main-column">
                    <h4 class="st-form-section-title" style="margin-bottom: 0.5rem; border-bottom: none;">
                        <i class='bx bx-dollar-circle'></i> Service Charges
                    </h4>
                    <button type="button" id="addChargeBtn_create" class="btn-goldmex-secondary btn-add-charge">
                        <i class='bx bx-plus'></i> Add Charge
                    </button>
                    <div class="st-charges-header-row">
                        <div class="st-charge-header-item charge-name-header">Charge Type</div>
                        <div class="st-charge-header-item charge-cost-header">Price</div>
                        <div class="st-charge-header-item charge-currency-header">Currency</div>
                        <div class="st-charge-header-item charge-action-header">Action</div>
                    </div>
                    <div id="chargesContainerModal_create" class="st-charges-list-container">
                        </div>
                </div>
            </form>
            <div class="st-modal-footer">
                <button type="button" id="cancelServiceBtn" class="btn-goldmex-secondary">Cancel</button>
                <button type="submit" form="newServiceForm" id="createServiceBtn" class="btn-goldmex-primary">Create Service</button>
            </div>
        </div>
    </div>

    <div id="viewServiceModal" class="st-modal">
        <div class="st-modal-content st-modal-content-xlarge">
            <div class="st-modal-header">
                <h3 id="viewServiceModalTitle"><i class='bx bx-show-alt'></i> Service Details <span id="viewServiceTypeBadge" class="st-type-badge"></span></h3>
                <button class="st-close-button" id="closeViewServiceModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <div id="viewServiceDetailsBody" class="st-modal-body st-modal-body-columns">
                <div class="st-form-main-column">
                    <div class="st-detail-section">
                        <h4><i class='bx bx-info-circle'></i> General Information</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label">Service ID:</span><span class="st-detail-value" id="viewServiceId"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Customer:</span><span class="st-detail-value" id="viewCustomer"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">ETD:</span><span class="st-detail-value" id="viewEtd"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">ETA:</span><span class="st-detail-value" id="viewEta"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Shipper:</span><span class="st-detail-value" id="viewShipper"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Consignee:</span><span class="st-detail-value" id="viewConsignee"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Carrier:</span><span class="st-detail-value" id="viewCarrier"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">POL:</span><span class="st-detail-value" id="viewPol"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">POD:</span><span class="st-detail-value" id="viewPod"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Final Destination:</span><span class="st-detail-value" id="viewFinalDestination"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">MBL/MAWB/PRO:</span><span class="st-detail-value" id="viewMblHawbPro"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Status:</span><span class="st-detail-value" id="viewServiceStatus"></span></div>
                        </div>
                    </div>
                    <div id="viewOceanSpecificDetails" class="st-detail-section" style="display:none;">
                        <h4>üåä Ocean Details</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label">HBL:</span><span class="st-detail-value" id="viewHblOcean"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Ocean Service Type:</span><span class="st-detail-value" id="viewOceanServiceType"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Ocean Service:</span><span class="st-detail-value" id="viewOceanService"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Container Number:</span><span class="st-detail-value" id="viewContainerNumber"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Container Type:</span><span class="st-detail-value" id="viewContainerType"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Seal Number:</span><span class="st-detail-value" id="viewSealNumber"></span></div>
                        </div>
                    </div>
                    <div id="viewAirSpecificDetails" class="st-detail-section" style="display:none;">
                        <h4>‚úàÔ∏è Air Details</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label">HAWB:</span><span class="st-detail-value" id="viewHblAir"></span></div>
                            <div class="st-detail-group" id="viewFlightNumberGroup"><span class="st-detail-label">Flight Number:</span><span class="st-detail-value" id="viewFlightNumber"></span></div>
                            <div class="st-detail-group" id="viewDimensionsAirGroup"><span class="st-detail-label">Dimensions:</span><span class="st-detail-value" id="viewDimensionsAir"></span></div>
                        </div>
                    </div>
                    <div id="viewTruckSpecificDetails" class="st-detail-section" style="display:none;">
                        <h4>üöö Truck Details</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label">Truck Service Type:</span><span class="st-detail-value" id="viewTruckServiceType"></span></div>
                            <div class="st-detail-group" id="viewDimensionsTruckGroup"><span class="st-detail-label">Dimensions:</span><span class="st-detail-value" id="viewDimensionsTruck"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">CBM:</span><span class="st-detail-value" id="viewCbm"></span></div>
                        </div>
                    </div>
                    <div class="st-detail-section">
                        <h4><i class='bx bx-package'></i> Cargo Details</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label"># Packages/Pieces:</span><span class="st-detail-value" id="viewNumPackages"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">Gross Weight:</span><span class="st-detail-value" id="viewGrossWeight"></span></div>
                            <div class="st-detail-group st-detail-full-width"><span class="st-detail-label">Commodity Description:</span><span class="st-detail-value" id="viewCommodityDescription"></span></div>
                            <div class="st-detail-group"><span class="st-detail-label">HTS Code:</span><span class="st-detail-value" id="viewHtsCode"></span></div>
                        </div>
                    </div>
                    <div class="st-detail-section">
                        <h4><i class='bx bx-note'></i> Additional Notes</h4>
                        <div class="st-detail-group st-detail-full-width">
                            <span class="st-detail-value" id="viewServiceNotes" style="white-space: pre-wrap; padding-left:0;"></span>
                        </div>
                    </div>
                     <div class="st-detail-section">
                        <h4><i class='bx bx-user-circle'></i> Creator Information</h4>
                        <div class="st-detail-grid">
                            <div class="st-detail-group"><span class="st-detail-label">Created By:</span><span class="st-detail-value" id="viewServiceCreator"></span></div>
                        </div>
                    </div>
                </div>
                <div class="st-charges-main-column st-charges-view-column">
                    <h4 class="st-form-section-title" style="margin-bottom: 0.5rem; border-bottom: none;">
                        <i class='bx bx-dollar-circle'></i> Service Charges
                    </h4>
                    <div id="viewServiceChargesContainer" class="st-charges-list-container-view">
                        <p id="viewNoChargesMessage" class="st-detail-value" style="font-style: italic; display: none; text-align:center; padding:1rem;">No charges associated with this service.</p>
                    </div>
                </div>
            </div>
            <div class="st-modal-footer">
                <button type="button" id="closeViewModalFooterBtn" class="btn-goldmex-secondary">Close</button>
            </div>
        </div>
    </div>

    <div id="editServiceModal" class="st-modal">
        <div class="st-modal-content st-modal-content-xlarge"> <div class="st-modal-header">
                <h3><i class='bx bx-edit-alt'></i> Edit Service <span id="editServiceDisplayIdHeader" class="st-type-badge" style="font-size: 0.9em; background-color: transparent; color: var(--color-text-secondary); border: none; padding-left: 5px;"></span></h3>
                <button class="st-close-button" id="closeEditServiceModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <form id="editServiceForm" class="st-modal-body st-modal-body-columns">
                <input type="hidden" id="editServiceId" name="editServiceId">
                <div class="st-form-main-column">
                    <div class="st-form-column-section">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bx-info-circle'></i> General Information</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editServiceCategoryModal">Service Type: <span class="st-required">*</span></label>
                                    <select id="editServiceCategoryModal" name="serviceCategoryModal" required>
                                        <option value="" disabled>Select a type...</option>
                                        <option value="ocean">üåä Ocean</option>
                                        <option value="air">‚úàÔ∏è Air</option>
                                        <option value="truck">üöö Domestic / Truck</option>
                                    </select>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editCustomerModal">Customer: <span class="st-required">*</span></label>
                                    <input type="text" id="editCustomerModal" name="customerModal" placeholder="Customer Name" required>
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editEtdModal">ETD: <span class="st-required">*</span></label>
                                    <input type="date" id="editEtdModal" name="etdModal" required>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editEtaModal">ETA: <span class="st-required">*</span></label>
                                    <input type="date" id="editEtaModal" name="etaModal" required>
                                </div>
                            </div>
                        </div>

                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-user-detail'></i> Parties Involved</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editShipperModal">Shipper: <span class="st-required">*</span></label>
                                    <input type="text" id="editShipperModal" name="shipperModal" placeholder="Shipper Name" required>
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editConsigneeModal">Consignee: <span class="st-required">*</span></label>
                                    <input type="text" id="editConsigneeModal" name="consigneeModal" placeholder="Consignee Name" required>
                                </div>
                            </div>
                             <div class="st-form-row">
                                 <div class="st-form-group st-form-group-col">
                                    <label for="editCarrierModal">Carrier: <span class="st-required">*</span></label>
                                    <input type="text" id="editCarrierModal" name="carrierModal" placeholder="Carrier Name" required>
                                </div>
                                <div class="st-form-group st-form-group-col" id="editFlightNumberGroupModal" style="display:none;">
                                    <label for="editFlightNumberModal">Flight Number (Air):</label>
                                    <input type="text" id="editFlightNumberModal" name="flightNumberModal" placeholder="Flight Number">
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="st-form-column-section">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-map-pin'></i> Logistics Details</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editPolModal">POL:</label>
                                    <input type="text" id="editPolModal" name="polModal" placeholder="Port/Point of Loading">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editPodModal">POD:</label>
                                    <input type="text" id="editPodModal" name="podModal" placeholder="Port/Point of Discharge">
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editFinalDestinationModal">Final Destination:</label>
                                    <input type="text" id="editFinalDestinationModal" name="finalDestinationModal" placeholder="Final Destination">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editMblHawbModal">MBL / MAWB / PRO:</label>
                                    <input type="text" id="editMblHawbModal" name="mblHawbModal" placeholder="MBL/MAWB/PRO">
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col" id="editHblHawbGroupModal" style="display:none;">
                                    <label for="editHblModal">HBL (Ocean) / HAWB (Air):</label>
                                    <input type="text" id="editHblModal" name="hblModal" placeholder="HBL / HAWB">
                                </div>
                                <div class="st-form-group st-form-group-col"></div> </div>
                        </div>

                        <div class="st-form-section">
                             <h4 class="st-form-section-title"><i class='bx bx-cog'></i> Service Specifics</h4>
                            <div id="editOceanFieldsModal" class="st-service-type-fields">
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editOceanServiceTypeModal">Ocean Service Type: <span class="st-required">*</span></label>
                                        <select id="editOceanServiceTypeModal" name="oceanServiceTypeModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="LCL">LCL</option> <option value="FCL">FCL</option>
                                        </select>
                                    </div>
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editOceanServiceModal">Ocean Service: <span class="st-required">*</span></label>
                                        <select id="editOceanServiceModal" name="oceanServiceModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="Door to Door">Door to Door</option> <option value="Door to Port">Door to Port</option>
                                            <option value="Port to Door">Port to Door</option> <option value="Port to Port">Port to Port</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="st-form-row" id="editContainerFieldsModal" style="display:none;">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editContainerNumberModal">Container Number:</label>
                                        <input type="text" id="editContainerNumberModal" name="containerNumberModal">
                                    </div>
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editContainerTypeModal">Container Type:</label>
                                        <input type="text" id="editContainerTypeModal" name="containerTypeModal">
                                    </div>
                                </div>
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editSealNumberModal">Seal Number:</label>
                                        <input type="text" id="editSealNumberModal" name="sealNumberModal">
                                    </div>
                                    <div class="st-form-group st-form-group-col"></div>
                                </div>
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editIsfFileModal">ISF File:</label>
                                        <input type="file" id="editIsfFileModal" name="isfFileModal" class="st-file-input">
                                        <span id="currentIsfFile" class="st-current-file-display"></span>
                                    </div>
                                    <div class="st-form-group st-form-group-col st-checkbox-group" style="align-self: flex-end; padding-bottom: 0.7rem;">
                                        <input type="checkbox" id="editAddIsfLaterModal" name="addIsfLaterModal">
                                        <label for="editAddIsfLaterModal">Add ISF Later <span class="st-required" id="editIsfRequiredIndicatorModal">*</span></label>
                                    </div>
                                </div>
                                <p class="st-validation-error" id="editIsfErrorModal" style="display:none;"></p>
                            </div>
                            <div id="editTruckFieldsModal" class="st-service-type-fields">
                                <div class="st-form-row">
                                    <div class="st-form-group st-form-group-col">
                                        <label for="editTruckServiceTypeModal">Truck Service Type: <span class="st-required">*</span></label>
                                        <select id="editTruckServiceTypeModal" name="truckServiceTypeModal">
                                            <option value="" disabled selected>Select...</option>
                                            <option value="FTL">FTL</option> <option value="LTL">LTL</option>
                                        </select>
                                    </div>
                                    <div class="st-form-group st-form-group-col"></div>
                                </div>
                            </div>
                            <div id="editAirFieldsModal" class="st-service-type-fields">
                                <p><em>No additional mandatory fields for Air.</em></p>
                            </div>
                        </div>
                    </div>
                    <div class="st-form-bottom-row">
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bxs-package'></i> Cargo Details</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editNumPackagesModal"># Packages:</label>
                                    <input type="number" id="editNumPackagesModal" name="numPackagesModal">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editGrossWeightModal">Gross Weight (kg):</label>
                                    <input type="number" step="0.01" id="editGrossWeightModal" name="grossWeightModal">
                                </div>
                            </div>
                            <div class="st-form-row" id="editDimensionsCbmGroupModal" style="display:none;">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editDimensionsModal">Dimensions (Air/Truck):</label>
                                    <input type="text" id="editDimensionsModal" name="dimensionsModal">
                                </div>
                                <div class="st-form-group st-form-group-col">
                                    <label for="editCbmModal">CBM (Truck):</label>
                                    <input type="number" step="0.001" id="editCbmModal" name="cbmModal">
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col-full">
                                    <label for="editCommodityDescriptionModal">Commodity Description:</label>
                                    <textarea id="editCommodityDescriptionModal" name="commodityDescriptionModal" rows="2"></textarea>
                                </div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editHtsCodeModal">HTS Code:</label>
                                    <input type="text" id="editHtsCodeModal" name="htsCodeModal">
                                </div>
                                <div class="st-form-group st-form-group-col"></div>
                            </div>
                        </div>
                        <div class="st-form-section">
                            <h4 class="st-form-section-title"><i class='bx bx-analyse'></i> Status & Notes</h4>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col">
                                    <label for="editServiceStatusModal">Service Status:</label>
                                    <select id="editServiceStatusModal" name="serviceStatusModal">
                                        <option value="Pending">Pending</option> <option value="Booked">Booked</option>
                                        <option value="In Transit">In Transit</option> <option value="At Destination">At Destination</option>
                                        <option value="Delivered">Delivered</option> <option value="On Hold">On Hold</option>
                                        <option value="Cancelled">Cancelled</option> <option value="Completed">Completed</option>
                                    </select>
                                </div>
                                <div class="st-form-group st-form-group-col"></div>
                            </div>
                            <div class="st-form-row">
                                <div class="st-form-group st-form-group-col-full">
                                    <label for="editServiceNotesModal">Additional Notes:</label>
                                    <textarea id="editServiceNotesModal" name="serviceNotesModal" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="st-charges-main-column">
                    <h4 class="st-form-section-title" style="margin-bottom: 0.5rem; border-bottom: none;">
                        <i class='bx bx-dollar-circle'></i> Service Charges
                    </h4>
                    <button type="button" id="addChargeBtn_edit" class="btn-goldmex-secondary btn-add-charge">
                        <i class='bx bx-plus'></i> Add New Charge
                    </button>
                     <div class="st-charges-header-row">
                        <div class="st-charge-header-item charge-name-header">Charge Type</div>
                        <div class="st-charge-header-item charge-cost-header">Price</div>
                        <div class="st-charge-header-item charge-currency-header">Currency</div>
                        <div class="st-charge-header-item charge-action-header">Action</div>
                    </div>
                    <div id="chargesContainerModal_edit" class="st-charges-list-container">
                        </div>
                </div>
            </form>
            <div class="st-modal-footer">
                <button type="button" id="cancelEditServiceBtn" class="btn-goldmex-secondary">Cancel</button>
                <button type="submit" form="editServiceForm" id="saveServiceChangesBtn" class="btn-goldmex-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="documentManagementModal" class="st-modal">
        <div class="st-modal-content" style="max-width: 800px;">
            <div class="st-modal-header">
                <h3 id="docModalTitle"><i class='bx bx-folder-open'></i> Service Documents - <span id="docModalServiceId"></span></h3>
                <button class="st-close-button" id="closeDocModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <div class="st-modal-body">
                <div class="st-doc-upload-section">
                    <h4><i class='bx bx-cloud-upload'></i> Upload New Document</h4>
                    <div class="st-form-grid">
                        <div class="st-form-group">
                            <label for="docCategorySelect">Document Category:</label>
                            <select id="docCategorySelect" name="docCategorySelect">
                                <option value="" selected disabled>Select a category...</option>
                            </select>
                        </div>
                        <div class="st-form-group">
                            <label for="docTypeSelect">Document Type:</label>
                            <select id="docTypeSelect" name="docTypeSelect" disabled>
                                <option value="" selected disabled>Select a type...</option>
                            </select>
                        </div>
                        <div class="st-form-group st-form-group-file">
                            <label for="docFileInput">Select File:</label>
                            <input type="file" id="docFileInput" name="docFileInput" class="st-file-input">
                        </div>
                        <div class="st-form-group st-form-group-button">
                            <button type="button" id="uploadDocBtn" class="btn-goldmex-primary"><i class='bx bx-upload'></i> Upload</button>
                        </div>
                    </div>
                </div>

                <div class="st-doc-list-section">
                    <h4><i class='bx bx-list-ul'></i> Uploaded Documents</h4>
                    <div id="docListContainer" class="st-doc-list-container">
                        <p id="noDocsMessage" class="st-no-docs-message" style="display:none; text-align:center; padding: 1rem; color: var(--color-text-secondary);">
                            No documents uploaded for this service yet.
                        </p>
                    </div>
                </div>
            </div>
            <div class="st-modal-footer">
                <button type="button" id="closeDocModalFooterBtn" class="btn-goldmex-secondary">Close</button>
            </div>
        </div>
    </div>

    <div id="archiveServiceModal" class="st-modal">
        <div class="st-modal-content" style="max-width: 90vw; width: 1200px;"> <div class="st-modal-header">
                <h3><i class='bx bx-calendar-event'></i> Monthly Service Archive</h3>
                <button class="st-close-button" id="closeArchiveServiceModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <div class="st-modal-body">
                <div class="st-archive-controls">
                    <div class="st-form-group">
                        <label for="archiveMonthSelect">Month:</label>
                        <select id="archiveMonthSelect" name="archiveMonthSelect">
                            </select>
                    </div>
                    <div class="st-form-group">
                        <label for="archiveYearSelect">Year:</label>
                        <select id="archiveYearSelect" name="archiveYearSelect">
                            </select>
                    </div>
                     <div class="st-form-group">
                        <label for="archiveServiceTypeSelect">Service Type:</label>
                        <select id="archiveServiceTypeSelect" name="archiveServiceTypeSelect">
                            <option value="all" selected>All</option>
                            <option value="ocean">üåä Ocean</option>
                            <option value="air">‚úàÔ∏è Air</option>
                            <option value="truck">üöö Domestic / Truck</option>
                        </select>
                    </div>
                    <button id="filterArchiveBtn" class="btn-goldmex-primary">
                        <i class='bx bx-filter-alt'></i> Filter Month
                    </button>
                </div>
                <div id="archiveTotalResults" style="margin-bottom: 1rem; font-weight: 500;">Results: 0</div>
                <div class="st-table-container" id="archiveTableContainer" style="max-height: 60vh; overflow-y: auto;">
                     <table id="archiveServicesTable" class="display responsive nowrap" style="width:100%">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                    <p id="noArchiveResultsMessage" style="text-align:center; padding: 2rem; display:none;">No services found for the selected month and year.</p>
                </div>
            </div>
            <div class="st-modal-footer">
                <button type="button" id="closeArchiveModalFooterBtn" class="btn-goldmex-secondary">Close</button>
            </div>
        </div>
    </div>

    <div id="progressNotificationModal" class="st-modal">
        <div class="st-modal-content" style="max-width: 900px;">
            <div class="st-modal-header">
                <h3><i class='bx bx-bell'></i> Transit Progress Notification</h3>
                <button class="st-close-button" id="closeProgressNotificationModalBtn" aria-label="Close modal">&times;</button>
            </div>
            <div class="st-modal-body">
                <p style="margin-bottom: 1rem; text-align: center; font-style: italic; color: var(--color-text-secondary);">
                    Showing services currently in transit. (Automatic updates 3 times a day, 8 AM - 5 PM Tijuana Time)
                </p>
                <div class="st-table-container" style="max-height: 60vh; overflow-y: auto;">
                    <table id="progressNotificationTable" class="display responsive nowrap" style="width:100%">
                        <thead>
                            <tr>
                                <th>Service ID</th>
                                <th>Type</th>
                                <th>Customer</th>
                                <th>ETD</th>
                                <th>ETA</th>
                                <th>Status</th>
                                </tr>
                        </thead>
                        <tbody id="progressNotificationTableBody">
                            </tbody>
                    </table>
                    <p id="noProgressServicesMessage" style="text-align:center; padding: 2rem; display:none; color: var(--color-text-secondary);">
                        No active services in transit to display.
                    </p>
                </div>
            </div>
            <div class="st-modal-footer">
                <button type="button" id="closeProgressNotificationFooterBtn" class="btn-goldmex-secondary">Close</button>
            </div>
        </div>
    </div>

    <div class="st-table-container">
        <table id="servicesTable" class="display responsive nowrap" style="width:100%">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="stCustomConfirmModal" class="st-modal" style="display: none;">
        <div class="st-modal-content" style="max-width: 450px;">
            <div class="st-modal-header">
                <h3 id="stCustomConfirmTitle">Confirm Action</h3>
                <button class="st-close-button" id="stCustomConfirmCloseBtn" aria-label="Close">&times;</button>
            </div>
            <div class="st-modal-body">
                <p id="stCustomConfirmMessage" style="margin-bottom: 1.5rem; line-height: 1.6; font-size: 1rem;"></p>
            </div>
            <div class="st-modal-footer">
                <button type="button" id="stCustomConfirmCancelBtn" class="btn-goldmex-secondary">Cancel</button>
                <button type="button" id="stCustomConfirmOkBtn" class="btn-goldmex-primary">OK</button>
            </div>
        </div>
    </div>

    <div id="customNotificationContainerST" class="custom-notification-st-container"></div>

</div>
